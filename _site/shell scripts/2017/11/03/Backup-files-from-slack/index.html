<!DOCTYPE html> <html lang="en-us"> <head> <link href="http://gmpg.org/xfn/11" rel="profile" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta http-equiv="content-type" content="text/html; charset=utf-8" /> <!-- Enable responsiveness on mobile devices--> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" /> <title> Backup Files From Slack &middot; Jian </title> <script type="text/javascript"> var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-55422968-1"]);_gaq.push(["_trackPageview"]);(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})() </script> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css" /> <link href='https://fonts.googleapis.com/css?family=Abril+Fatface' rel='stylesheet' type='text/css'> <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" /> --> <!-- Icons --> <!-- <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" /> --> <link rel="shortcut icon" href="/favicon.ico" /> <!-- RSS --> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <!-- Additional head bits without overriding original head --> </head> <body class="post"> <div id="sidebar"> <header> <div class="site-title"> <a href="/"> <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/> </svg></span> Jian </a> </div> <p class="lead">A Programming Blog</p> </header> <nav id="sidebar-nav-links"> <a class="home-link " href="/">Home</a> <a class="page-link " href="/Teaching/">Teaching</a> <a class="page-link " href="/about/">About</a> <a class="page-link " href="/cv/">Curriculum Vitae</a> <a class="page-link " href="/timeline/">Time Line</a> <!-- <a class="category-link " href="/category/java/">Java</a> <a class="category-link " href="/category/javascript/">JavaScript</a> <a class="category-link " href="/category/shell-script/">Shell Scripts</a> --> <!-- Optional additional links to insert in sidebar nav --> <a class="page-link " href="http://www.github.com/JianLoong/feedback/issues/new/">Question?</a> </nav> <!-- <span class="site-version">Currently v3.4.1</span> --> <nav id="sidebar-icon-links"> <a id="github-link" class="icon" title="Github Project" aria-label="Github Project" href="https://github.com/JianLoong/"> <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path> </svg> </a> <a id="github-link" class="icon" title="Github Project" aria-label="Disclaimer" href="/Disclaimer"> <svg version="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" enable-background="new 0 0 48 48"> <g fill="#FFFFFF"> <path d="M13,22H8v-8.5c0-1.4,1.1-2.5,2.5-2.5h0c1.4,0,2.5,1.1,2.5,2.5V22z"/> <path d="M20,22h-5V7.5C15,6.1,16.1,5,17.5,5h0C18.9,5,20,6.1,20,7.5V22z"/> <path d="M27,22h-5V5.5C22,4.1,23.1,3,24.5,3h0C25.9,3,27,4.1,27,5.5V22z"/> <path d="M34,22h-5V8.5C29,7.1,30.1,6,31.5,6h0C32.9,6,34,7.1,34,8.5V22z"/> <path d="M32.1,43L27.1,38l10-10c1.4-1.4,3.6-1.4,4.9,0l0,0c1.4,1.4,1.4,3.6,0,4.9L32.1,43z"/> <path d="M29,21c0,0.6-0.4,1-1,1s-1-0.4-1-1h-5c0,0.6-0.4,1-1,1s-1-0.4-1-1h-5c0,0.6-0.4,1-1,1s-1-0.4-1-1H8v16 c0,4.4,3.6,8,8,8h11.2c3.7,0,6.8-3,6.8-6.8V21H29z"/> </g> <g fill="#FFFFFF"> <rect x="20.2" y="25.5" transform="matrix(.707 -.707 .707 .707 -16.897 25.224)" width="3.5" height="15"/> <rect x="20.2" y="25.6" transform="matrix(.707 .707 -.707 .707 29.811 -5.877)" width="3.5" height="15"/> </g> </svg> </a> <!-- <a id="github-download-link" class="icon" title="Download" aria-label="Download" href="https://github.com/JianLoong//archive/v3.4.1.zip"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/> <path d="M0 0h24v24H0z" fill="none"/> </svg> </a> --> <a id="subscribe-link" class="icon" title="Subscribe" aria-label="Subscribe" href="/feed.xml"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <circle cx="6.18" cy="17.82" r="2.18"/> <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/> </svg> </a> <a id="tags-link" class="icon" title="Tags" aria-label="Tags" href="/tags/"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/> </svg> </a> <a id="search-link" class="icon" title="Search" aria-label="Search" href="/search/"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/> <path d="M0 0h24v24H0z" fill="none"/> </svg> </a> <!-- Optional additional links to insert for icons links --> </nav> <p> &copy; 2018. <!-- <a href="/LICENSE.md">MIT License.</a> --> </p> </div> <main class="container"> <header> <h1 class="post-title">Backup Files From Slack</h1> </header> <div class="content"> <div class="post-meta"> <span class="post-date">03 Nov 2017</span> <span class="post-categories"> &bull; <a href="/category/shell-script/"> Shell Scripts </a> </span> </div> <div class="post-body"> <p>This was a simple shell script I wrote to allow the download of files that users send on public channels on Slack. The reason this was done was because…</p> <h5 id="flashback-last-year">Flashback last year…</h5> <p>Person A - Hey, are you busy?</p> <p>Me - Nah, wassup?</p> <p>Person A - Well, our Slack has been telling us to pay them……Could you like backup the files?</p> <p>Me - Sure, OK.</p> <p>Hours later…..</p> <p><img src="/assets/images/running.png" alt="Alt text" class="img-smaller" /></p> <!--more--> <p>Requirements for the script are as follows.</p> <table> <thead> <tr> <th style="text-align: left">Requires</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">jq</td> <td style="text-align: left">Command Line JSON parser</td> </tr> <tr> <td style="text-align: left">cURL</td> <td style="text-align: left">Tool to transfer data from the server</td> </tr> </tbody> </table> <p>If you do not have these or know about them, I highly suggest to go about learning what these are first before even attempting this.</p> <p>So, I came to the conclusion that the easiest way I could do it is just to write a simple shell script to do it. What can an easier way be? Spend 5 hours reading their API? Writing a Java / Python or C# program? Nope.</p> <p>My idea was pretty simple, I am going to check out some of the REST API end points and then look at the files that can be downloaded, then I am going to use cURL or WGET to ninja all of it at one go.</p> <p>The shell script is provided at my repository. The script itself can be improved in many ways but it was meant to be something simple to begin with.</p> <p>The first step itself is pretty simple. You will need to obtain a XOXP token. You obviously need some rights to obtain this token. Mind you this was 1 year ago. So, you can say that this post is delayed for 1 year. Woohoo.</p> <p>My plan was just to use a cron to run the script everyday so that backup happens. Easy mode.</p> <p>Obtaining the XOXP token is a simple step. You will need to generate a “legacy” token. Because, hey anything older than a year is legacy these days! On a more serious note, there is obviously a reason for it being called legacy.</p> <p><a href="https://api.slack.com/custom-integrations/legacy-tokens" class="img-smaller">Token found here</a></p> <p><img src="/assets/images/legacy_token_generator.png" alt="Legacy Token Generator" class="img-smaller" /></p> <p>You will need to select your work space and generate a XOXP token for it.</p> <script src="https://gist.github.com/JianLoong/3221f6e6acf46ed2ea0a249d04b67d51.js"></script> <p>After that comes the fun part!</p> <p>Because I decided going through the entire API to find the actual way to download the file to be rather cumbersome and Mr. Google and Mr. Stackoverflow showed no promising way to do it, I decided to spoof my browser headers to download the image.</p> <p>The idea itself is quite simple.</p> <p>I am going to go to the URL on my browser then look at the inspect tool to see the headers.</p> <p>What I noticed is that the files in Slack follow a very simple URL pattern.</p> <p><code> https://files.slack.com/files-pri/SOMETHING/FILE_NAME.png </code></p> <p>So what I just need to do is first get all these URL and then do a curl for them.</p> <script src="https://gist.github.com/JianLoong/18135bb51bfea3093f95133468d278a6.js"></script> <p>What you will notice is that, if you run the script now, the value temp will actually tell you all the URLs of the files. So, the idea of it now is that you can look at the URL from your browser. Of course you will need to be logged on to Slack on your browser to view it. Once you open the inspect tool, you would be able to copy and paste the headers just like the screen shot below. This is under the network tab.</p> <p><img src="/assets/images/url-header-slack.png" alt="Alt text" class="img-smaller" /></p> <p>After that, you will need to put that line in the correct place with the correct url.</p> <p>In order to run the script, you will need to give it execute permission. Then, it should download all of the files into that directory.</p> <div class="post-tags"> <a href="/tags/#slack"> <span class="icon"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/> </svg> </span>&nbsp;<span class="tag-name">Slack</span> </a> <a href="/tags/#shell-script"> <span class="icon"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/> </svg> </span>&nbsp;<span class="tag-name">Shell Script</span> </a> <a href="/tags/#jq"> <span class="icon"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/> </svg> </span>&nbsp;<span class="tag-name">jq</span> </a> <a href="/tags/#curl"> <span class="icon"> <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/> </svg> </span>&nbsp;<span class="tag-name">curl</span> </a> </div> </div> <section class="comments"> <h2>Comments</h2> <div id="disqus_thread"> <button class="disqus-load" onClick="loadDisqusComments()"> Load Comments </button> </div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW * TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s * https://disqus.com/admin/universalcode/#configuration-variables */ // var disqus_config = function () { // this.page.url = "http://localhost:4000/shell%20scripts/2017/11/03/Backup-files-from-slack/"; // this.page.identifier = "" || // "http://localhost:4000/shell%20scripts/2017/11/03/Backup-files-from-slack/"; // } // function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE // var d = document, s = d.createElement('script'); // s.src = 'https://jianloonggithubio.disqus.com/embed.js'; // s.setAttribute('data-timestamp', +new Date()); // (d.head || d.body).appendChild(s); // } </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>. </noscript> </section> <section class="related"> <h2>Related Posts</h2> <ul class="posts-list"> <li> <h3> <a href="/java/2018/04/08/Effective-Java-Static-Factory-Methods/"> Static Factory Methods in Java <small>08 Apr 2018</small> </a> </h3> </li> <li> <h3> <a href="/react/2018/04/04/Thinking-in-React/"> Thinking in React <small>04 Apr 2018</small> </a> </h3> </li> <li> <h3> <a href="/use%20case/2018/04/02/Is-Login-A-Use-Case/"> Is Login A Use Case? <small>02 Apr 2018</small> </a> </h3> </li> </ul> </section> </div> </main> <!-- Optional footer content --> <script rel="text/javascript" src="/assets/js/disqus.js"></script> </body> </html>
